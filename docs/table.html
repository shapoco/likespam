<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">

    <meta name="keywords" content="X,Twitter,いいねスパム,公式スパム">
    <meta name="description" content="X で「いいね」を送りつけてくるスパムの一覧">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@shapoco" />
    <meta property="og:url" content="https://shapoco.github.io/likespam/" />
    <meta property="og:title" content="いいねスパム一覧" />
    <meta property="og:description" content="X で「いいね」を送りつけてくるスパムの一覧" />
    <meta property="og:image" content="https://shapoco.github.io/likespam/card.png" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BMDGFGR0Z4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BMDGFGR0Z4');
    </script>

    <!-- <link rel="icon" href="/likespam/favicon192.png" sizes="192x192"> -->
    <!-- <link rel="apple-touch-icon" href="/likespam/apple-touch-icon180.png" sizes="180x180"> -->
    <link rel="shortcut icon" href="/likespam/favicon48.ico">

    <title>PC用 表形式 | いいねスパム一覧</title>
    <link href="./style.css?20240925072240" rel="stylesheet" type="text/css">
    <script src="./index.js?20240925072240"></script>
    <script src="./database.js?20240925083937"></script>
  </head>

  <body>
    <div class="header"><img src="cover.png"></div>
    <div class="author">
      管理者: <a href="https://x.com/syego" target="_blank">@syego</a>
    </div>
    <p id="menu"></p><script>render_menu(1);</script>
    
    <h1>いいねスパム一覧 (PC用 表形式)</h1>

    <p>
      スマホ等で 1 アカウントずつ開くのが面倒な場合は 20 アカウントずつにまとまった <a href="./">グループ形式版</a> をご覧下さい。
    </p>

    <p>打ち消し線: 凍結確認済 (水色: 過去24時間以内に凍結確認)</p>
    
    <p id="status"></p>
    
    <table id="spam_table">
      <tr>
        <th>#</th>
        <th>追加日</th>
        <th>screen_name</th>
        <th>user_id</th>
        <th>name</th>
      </tr>
    </table>

    <div id="table_size_warning" style="display: none;">
      <p>
        <strong>
          スパムアカウントの数が非常に多くなっているため、スマートフォンでは表が大きすぎてブラウザの動作が不安定になる場合があります。<br>
        </strong>
      </p>
      <p>
        <a href="javascript:generateTable();">表を表示するにはここをクリックしてください</a>
      </p>
    </div>

    <script>
      const STATUS_ICON_UNKNOWN = '⚪';
      const STATUS_ICON_CHECKING = '🟡';
      const STATUS_ICON_SUCCESS = '🟢';
      const STATUS_ICON_FAILED = '🔴';

      function main() {
        if (isSmartPhone()) {
          document.getElementById('table_size_warning').style.display = 'block';
        }
        else {
          generateTable();
        }
      }

      function generateTable() {
        document.getElementById('table_size_warning').style.display = 'none';

        now = Date.now();
        tbl = document.getElementById('spam_table');
        const num_spam = spam_items.length;
        var num_frozen = 0;
        for (var i = num_spam - 1; i >= 0; i--) {
          const spam = spam_items[i];
          const is_frozen = spam.frozen_date.trim().length != 0;
          const is_frozen_new = is_frozen && (now - new Date(spam.frozen_date.trim())) < 1000 * 60 * 60 * 24;
          if (is_frozen) num_frozen += 1;
          const userid_html = spam.user_id.length == 0 ? '' : '<a href="https://x.com/i/user/' + spam.user_id + '" target="_blank">' + spam.user_id + '</a>';
          const scrname_html = '<a href="https://x.com/' + spam.screen_name + '" target="_blank">@' + spam.screen_name + '</a>';
          //var icon_html = '<span id="status_icon_' + i + '" onMouseOver="javascript: checkProfileIconExistence(' + i + ')">' + STATUS_ICON_UNKNOWN + '</span>';
          td_num = document.createElement('td'); 
          td_added = document.createElement('td');
          td_scrname = document.createElement('td');
          td_uesrid = document.createElement('td');
          td_name = document.createElement('td');
          td_num.innerHTML = (i + 1).toString();
          td_added.innerHTML = formatDate(new Date(spam.added_date));
          td_scrname.innerHTML = scrname_html;
          td_uesrid.innerHTML = userid_html;
          //td_name.innerHTML = icon_html + ' ' + spam.name;
          td_name.innerHTML = spam.name;
          tr = document.createElement('tr');
          if (is_frozen) {
            tr.classList.add("frozen");
          }
          if (is_frozen_new) {
            tr.classList.add("frozen_new");
          }
          tr.appendChild(td_num);
          tr.appendChild(td_added);
          tr.appendChild(td_scrname);
          tr.appendChild(td_uesrid);
          tr.appendChild(td_name);
          tbl.appendChild(tr);
        }
        document.getElementById('status').innerHTML = 
          num_spam + '件のスパム, ' + 
          num_frozen + '件凍結確認済 ' +
          '(' + Math.round(1000 * num_frozen / num_spam) / 10 + '%)';
      }

      function formatDate(d) {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);

        const isToday = d >= today && d < new Date(today.getTime() + 24 * 60 * 60 * 1000);
        const isYesterday = d >= yesterday && d < today;
        const isThisYear = d.getFullYear() === now.getFullYear();

        const hours = d.getHours().toString().padStart(2, '0');
        const minutes = d.getMinutes().toString().padStart(2, '0');

        if (isToday) {
          return `今日 ${hours}:${minutes}`;
        } else if (isYesterday) {
          return `昨日 ${hours}:${minutes}`;
        } else if (isThisYear) {
          const month = (d.getMonth() + 1);
          const day = d.getDate().toString().padStart(2, '0');
          return `${month}/${day} ${hours}:${minutes}`;
        } else {
          const year = d.getFullYear().toString().slice(-2);
          const month = (d.getMonth() + 1);
          const day = d.getDate().toString().padStart(2, '0');
          return `${year}/${month}/${day} ${hours}:${minutes}`;
        }
      }

      function checkProfileIconExistence(index) {
        const span = document.getElementById('status_icon_' + index);
        if (span.innerHTML != STATUS_ICON_UNKNOWN) return;
        span.innerHTML = STATUS_ICON_CHECKING;
        const url = spam_items[index].profile_image_url;
        checkIfImageExists(index, url)
          .then((index, url) => {
              //console.log(`Image found: ${index}`);
              span.innerHTML = STATUS_ICON_SUCCESS;
          })
          .catch((index, url) => {
              //console.log(`Image not found: ${index}`);
              span.innerHTML = STATUS_ICON_FAILED;
          });
      }

      function checkIfImageExists(index, url) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.src = url;
          img.onload = () => resolve(index, url);
          img.onerror = () => reject(index, url);
        });
      }

      function isSmartPhone() {
        if (window.matchMedia && window.matchMedia('(max-device-width: 640px)').matches) {
          return true;
        } else {
          return false;
        }
      }

      main();
    </script>

    <hr>
  </body>

</html>