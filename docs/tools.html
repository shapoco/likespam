<!DOCTYPE html>
<html lang="ja">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">

    <meta name="keywords" content="X,Twitter,いいねスパム,公式スパム">
    <meta name="description" content="X で「いいね」を送りつけてくるスパムの一覧">

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@shapoco" />
    <meta property="og:url" content="https://shapoco.github.io/likespam/" />
    <meta property="og:title" content="ツール | いいねスパム一覧" />
    <meta property="og:description" content="X で「いいね」を送りつけてくるスパムの一覧" />
    <meta property="og:image" content="https://shapoco.github.io/likespam/card.png" />

    <meta name="Hatena::Bookmark" content="nocomment" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BMDGFGR0Z4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-BMDGFGR0Z4');
    </script>

    <link rel="icon" href="/likespam/favicon192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="/likespam/apple-touch-icon180.png" sizes="180x180">
    <link rel="shortcut icon" href="/likespam/favicon48.ico">

    <title>ツール | いいねスパム一覧</title>
    <link href="./style.css?20241001020734" rel="stylesheet" type="text/css">
    <script src="./index.js?20241001020734"></script>
    <script src="./database.js?20241001123334"></script>
  </head>

  <body>
    <div class="header"><img src="cover.png"></div>
    <div class="author">
      管理者: <a href="https://x.com/syego" target="_blank">@syego</a>
    </div>
    <p class="menu_wrapper" id="menu"></p>
    <script>likeSpamRenderMenu(3);</script>

    <h1>ツール (管理用)</h1>

    <h2>URL生成</h2>

    <form name="f_idgen">
      <p>
        ID (スペースまたは改行区切り):<br>
        <textarea id="screen_names" cols="64" rows="16" style="overflow-y: scroll;"></textarea><br>
        <input id="remove_known" type="checkbox" checked>
        <label for="remove_known">既知のアカウントは除く</label>
        <input id="remove_frozen" type="checkbox" checked>
        <label for="remove_frozen">凍結済みは除く</label>
        <button id="apply_normal" type="button">正規化適用</button>
      </p>
    </form>
    <p id="idgen_result"></p>
    <ol id="search_links"></ol>
    <ol id="profile_links"></ol>
    <p id="regex_text"></p>

    <script>
      var knownScreenNames = {};
      var frozenScreenNames = {};

      function main() {
        document.f_idgen.screen_names.addEventListener('change', screenNamesChanged);
        document.f_idgen.screen_names.addEventListener('keyup', screenNamesChanged);
        document.f_idgen.remove_known.addEventListener('change', screenNamesChanged);
        document.f_idgen.remove_frozen.addEventListener('change', screenNamesChanged);
        document.f_idgen.apply_normal.addEventListener('click', applyNormal);
        likeSpams.forEach(spam => {
          const key = spam.screenName.toLowerCase();
          knownScreenNames[key] = true;
          if (!!(spam.frozenDate)) {
            frozenScreenNames[key] = true;
          }
        });
      }

      function screenNamesChanged(e) {
        const items = getNormalizedScreenNames();

        {
          const GROUP_SIZE = 20;
          var html = '';
          for (var istep = 0; istep < items.length; istep+=GROUP_SIZE) {
            var ifrom = istep;
            var ito = ifrom + GROUP_SIZE;
            if (ito > items.length) ito = items.length;
            html += `<li>${lkspGetSearchLinkHtml(items.slice(ifrom, ito), null, null)}</li>`;
          }
          document.querySelector('#search_links').innerHTML = html;
        }

        {
          const ul = document.getElementById('profile_links');
          ul.innerHTML = '';
          for(var i = 0; i < items.length; i++) {
            url = 'https://x.com/' + items[i];
            li = document.createElement('li');
            li.innerHTML = '<a href="' + url + '" target="_blank">' + url + '</a>';
            ul.appendChild(li);
          }
        }

        {
          const p = document.getElementById('regex_text');
          var text = '';
          if (items.length > 0) {
            text += '\\b('
            for(var i = 0; i < items.length; i++) {
              text += items[i];
              if (i < items.length - 1) {
                text += '|';
              }
            }
            text += ')\\b';
          }
          p.innerHTML = text;
        }
      }

      function applyNormal() {
        const items = getNormalizedScreenNames();
        document.f_idgen.screen_names.value = items.join(' ');
      }

      function getNormalizedScreenNames() {
        const textarea = document.f_idgen.screen_names;
        const remove_known = document.f_idgen.remove_known.checked;
        const remove_frozen = document.f_idgen.remove_frozen.checked;
        var items = textarea.value.replace('\n', ' ').replace('\r', ' ').replace('\t', ' ').replace('　', ' ').trim().split(/\s+/g);
        for (var i = 0; i < items.length; i++) {
          items[i] = items[i].replace('https://x.com/', '')
          items[i] = items[i].replace('https://twitter.com/', '')
          if (items[i].startsWith('@')) {
            items[i] = items[i].substring(1);
          }
        }
        
        const numItemsOld0 = items.length;
        items = Array.from(new Set(items));
        const numItemsOld1 = items.length;
        if (remove_known) {
          items = items.filter(item => !(item.toLowerCase() in knownScreenNames));
        }
        const numItemsOld2 = items.length;
        if (remove_frozen) {
          items = items.filter(item => !(item.toLowerCase() in frozenScreenNames));
        }
        const numRemoveByConflict = numItemsOld0 - numItemsOld1;
        const numRemoveByKnown = numItemsOld1 - numItemsOld2;
        const numRemoveByFrozen = numItemsOld2 - items.length;

        var removes = [];
        if (numRemoveByConflict > 0) removes.push('重複による削除: ' + numRemoveByConflict + '個');
        if (numRemoveByFrozen > 0) removes.push('凍結による削除: ' + numRemoveByFrozen + '個');
        if (numRemoveByKnown > 0) removes.push('既知のアカウントの削除: ' + numRemoveByKnown + '個');
        const removesStr = removes.length > 0 ? ' <strong>(' + removes.join(', ') + ')</strong>' : '';
        document.getElementById('idgen_result').innerHTML = items.length + '個のアカウント' + removesStr;

        return items;
      }

      main();
    </script>

    <hr>
  </body>

</html>